<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ‘æ´èŠå¤©å®¤</title>
    <!-- è¿™æ˜¯é—²æš‡ä¹‹ä½™æ ¹æ®ç½‘å‹çš„çµæ„Ÿåˆ¶ä½œçš„ä¸€ä¸ªç®€å•çš„å‰ç«¯äº¤äº’ç½‘é¡µï¼Œè¯·å‹¿ç”¨ä½œå•†ä¸šç”¨é€”æˆ–å…¶ä»–æœ‰ä»·äº¤æ˜“ -->
     <!-- https://github.com/chahubeili/treeTalkRoom_wyh.git -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6c63ff',
                        secondary: '#f0f0f0',
                        accent: '#007bff',
                        dark: '#333333',
                        light: '#f9f9f9'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .glass-effect {
                backdrop-filter: blur(10px);
                background-color: rgba(255, 255, 255, 0.7);
            }
            .custom-shadow {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            }
            .transition-custom {
                transition: all 0.3s ease;
            }
            .checkbox-custom {
                position: relative;
                width: 18px;
                height: 18px;
                border: 1px solid #d1d5db;
                border-radius: 3px;
                cursor: pointer;
                display: inline-block;
                vertical-align: middle;
            }
            .checkbox-custom::after {
                content: '';
                position: absolute;
                display: none;
                left: 5px;
                top: 1px;
                width: 5px;
                height: 10px;
                border: solid white;
                border-width: 0 2px 2px 0;
                transform: rotate(45deg);
            }
            .checkbox-input:checked ~ .checkbox-custom {
                background-color: #6c63ff;
                border-color: #6c63ff;
            }
            .checkbox-input:checked ~ .checkbox-custom::after {
                display: block;
            }
        }
    </style>
</head>
<body class="font-inter bg-white min-h-screen flex items-center justify-center p-4 transition-colors duration-500">
    <!-- å³ä¸Šè§’å¤´åƒ -->
    <div id="topAvatar" class="fixed top-4 right-4 z-40 hidden md:block cursor-pointer">
        <img src="https://picsum.photos/seed/avatar/120/120" alt="ç”¨æˆ·å¤´åƒ" class="w-12 h-12 rounded-full border-2 border-white shadow-lg hover:scale-110 transition-transform duration-300">
    </div>

    <!-- å¤´åƒæŸ¥çœ‹å™¨ -->
    <div id="avatarViewer" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-transparent p-0 rounded-full shadow-2xl transform transition-transform duration-300 scale-95">
            <img id="viewerAvatar" src="" alt="æ”¾å¤§çš„å¤´åƒ" class="rounded-full">
        </div>
    </div>

    <div class="w-full max-w-2xl mx-auto">
        <!-- èƒŒæ™¯è®¾ç½®å¡ç‰‡ -->
        <div id="bg-settings-card" class="bg-white rounded-xl p-5 mb-6 custom-shadow transition-custom hover:shadow-md">
            <div class="flex justify-between items-center">
                <label class="text-dark font-medium">èƒŒæ™¯è®¾ç½®</label>
                <div class="flex items-center space-x-2">
                    <span class="text-dark text-sm">æ¯›ç»ç’ƒæ•ˆæœ</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="glassToggle" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-primary/30 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                    </label>
                </div>
            </div>
            <div class="flex flex-wrap gap-3 mt-4">
                <span class="w-10 h-10 rounded-full bg-white border border-gray-200 cursor-pointer transition-custom hover:scale-110 ring-2 ring-primary" data-color="#ffffff"></span>
                <span class="w-10 h-10 rounded-full bg-gray-100 border border-gray-200 cursor-pointer transition-custom hover:scale-110" data-color="#f0f0f0"></span>
                <span class="w-10 h-10 rounded-full bg-gray-200 border border-gray-200 cursor-pointer transition-custom hover:scale-110" data-color="#e0e0e0"></span>
                <span class="w-10 h-10 rounded-full bg-gray-300 border border-gray-200 cursor-pointer transition-custom hover:scale-110" data-color="#d0d0d0"></span>
                <span class="w-10 h-10 rounded-full bg-blue-50 border border-gray-200 cursor-pointer transition-custom hover:scale-110" data-color="#e8f4ff"></span>
                <span class="w-10 h-10 rounded-full bg-green-50 border border-gray-200 cursor-pointer transition-custom hover:scale-110" data-color="#e8fff0"></span>
                <span class="w-10 h-10 rounded-full bg-purple-50 border border-gray-200 cursor-pointer transition-custom hover:scale-110" data-color="#f3e8ff"></span>
                <span class="w-10 h-10 rounded-full bg-pink-50 border border-gray-200 cursor-pointer transition-custom hover:scale-110" data-color="#ffeef4"></span>
                <span class="w-10 h-10 rounded-full bg-gray-800 border border-gray-700 cursor-pointer transition-custom hover:scale-110" data-color="#333333"></span>
                <span class="w-10 h-10 rounded-full bg-blue-800 border border-blue-700 cursor-pointer transition-custom hover:scale-110" data-color="#1e40af"></span>
                <span class="w-10 h-10 rounded-full bg-purple-800 border border-purple-700 cursor-pointer transition-custom hover:scale-110" data-color="#5b21b6"></span>
            </div>
        </div>

        <!-- ä¸ªäººèµ„æ–™å¡ç‰‡ -->
        <div id="profile-card" class="bg-white rounded-xl p-6 mb-6 custom-shadow transition-custom hover:shadow-md">
            <div class="text-center">
                <div class="relative inline-block cursor-pointer" id="avatarContainer">
                    <img id="avatar" src="https://picsum.photos/seed/avatar/120/120" alt="chahubeili" class="w-24 h-24 rounded-full object-cover border-4 border-white shadow-md transition-custom">
                    <div class="absolute -bottom-1 -right-1 bg-primary text-white w-6 h-6 rounded-full flex items-center justify-center cursor-pointer hover:bg-primary/80 transition-custom" id="changeAvatarBtn">
                        <i class="fa fa-pencil text-xs"></i>
                    </div>
                </div>
                <div class="mt-4">
                    <h2 id="username" class="text-2xl font-bold text-dark">chahubeili</h2>
                    <p id="bio" class="mt-1 text-gray-500">è‹¦éš¾æ— æ³•é¿å…</p>
                </div>
                
                <div class="mt-6 flex justify-center space-x-4">
                    <a href="https://github.com/chahubeili" target="_blank" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 transition-custom hover:bg-primary hover:text-white hover:rotate-12" title="GitHub">
                        <i class="fa-brands fa-github"></i>
                    </a>
                    <a href="https://twitter.com/chahubeili" target="_blank" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 transition-custom hover:bg-primary hover:text-white hover:rotate-12" title="Twitter">
                        <i class="fa-brands fa-twitter"></i>
                    </a>
                    <a href="https://www.xiaoheihe.cn/user/profile/12345678" target="_blank" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 transition-custom hover:bg-primary hover:text-white hover:rotate-12" title="å°é»‘ç›’">
                        <i class="fa fa-gamepad"></i>
                    </a>
                    <a href="https://space.bilibili.com/12345678" target="_blank" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 transition-custom hover:bg-primary hover:text-white hover:rotate-12" title="Bilibili">
                        <i class="fa-brands fa-bilibili"></i>
                    </a>
                </div>
                
                <button id="editProfileBtn" class="mt-5 inline-block px-4 py-2 bg-primary/10 text-primary rounded-full text-sm font-medium transition-custom hover:bg-primary hover:text-white">
                    <i class="fa fa-user-edit mr-1"></i> ç¼–è¾‘èµ„æ–™
                </button>
            </div>
        </div>

        <!-- ç•™è¨€æ¿å¡ç‰‡ -->
        <div id="message-card" class="bg-white rounded-xl p-6 mb-6 custom-shadow transition-custom hover:shadow-md">
            <div class="flex justify-between items-center mb-4">
                <label class="text-dark font-medium">ç•™è¨€æ¿</label>
                <div class="relative">
                    <select id="sortSelect" class="appearance-none bg-gray-100 border-0 rounded-lg py-2 pl-4 pr-10 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="newest">æœ€æ–°åœ¨å‰</option>
                        <option value="oldest">æœ€æ—§åœ¨å‰</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                        <i class="fa fa-chevron-down text-xs"></i>
                    </div>
                </div>
            </div>
            
            <textarea id="messageInput" placeholder="ç•™ä¸‹ä½ çš„ç•™è¨€..." class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary resize-none h-24 transition-custom"></textarea>
            
            <div class="mt-3 flex items-center justify-between">
                <div class="flex items-center">
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="autoDelete" class="sr-only checkbox-input">
                        <span class="checkbox-custom"></span>
                        <span class="ml-2 text-sm text-gray-600">24å°æ—¶åè‡ªåŠ¨åˆ é™¤</span>
                    </label>
                </div>
                <div class="flex items-center">
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="anonymousMessage" class="sr-only checkbox-input">
                        <span class="checkbox-custom"></span>
                        <span class="ml-2 text-sm text-gray-600">åŒ¿åç•™è¨€</span>
                    </label>
                </div>
            </div>
            
            <button id="sendButton" class="mt-4 w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-custom transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center">
                <i class="fa fa-paper-plane mr-2"></i> å‘é€
            </button>
            
            <!-- ç•™è¨€å®¹å™¨ -->
            <div id="messagesContainer" class="mt-6 space-y-4">
                <!-- åˆå§‹çŠ¶æ€æç¤º -->
                <div id="emptyMessage" class="text-center py-8 text-gray-400">
                    <i class="fa fa-comment-dots text-3xl mb-2"></i>
                    <p>ç°åœ¨è¿˜æ²¡æœ‰ç•™è¨€ï¼Œå¿«æ¥ç•™ä¸‹ä½ çš„æƒ³æ³•å§ï¼</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘èµ„æ–™æ¨¡æ€æ¡† -->
    <div id="editProfileModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-dark">ç¼–è¾‘èµ„æ–™</h3>
                <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div class="text-center">
                    <img id="modalAvatar" src="https://picsum.photos/seed/avatar/120/120" alt="å½“å‰å¤´åƒ" class="w-24 h-24 rounded-full object-cover mx-auto mb-2">
                    <button id="uploadAvatarBtn" class="text-primary text-sm">ä¸Šä¼ æ–°å¤´åƒ</button>
                    <input type="file" id="avatarInput" class="hidden" accept="image/*">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ç”¨æˆ·å</label>
                    <input type="text" id="modalUsername" value="chahubeili" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ä¸ªäººç®€ä»‹</label>
                    <textarea id="modalBio" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary resize-none h-20">è‹¦éš¾æ— æ³•é¿å…</textarea>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button id="cancelEditBtn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">å–æ¶ˆ</button>
                    <button id="saveEditBtn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90">ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // èƒŒæ™¯é¢œè‰²é€‰æ‹©åŠŸèƒ½
        const colorBlocks = document.querySelectorAll('[data-color]');
        const body = document.body;
        
        colorBlocks.forEach(block => {
            block.addEventListener('click', () => {
                const color = block.getAttribute('data-color');
                body.style.backgroundColor = color;
                
                // æ›´æ–°é€‰ä¸­çŠ¶æ€
                colorBlocks.forEach(b => b.classList.remove('ring-2', 'ring-primary'));
                block.classList.add('ring-2', 'ring-primary');
                
                // å­˜å‚¨ç”¨æˆ·åå¥½
                localStorage.setItem('bgColor', color);
            });
        });
        
        // æ¯›ç»ç’ƒæ•ˆæœåˆ‡æ¢
        const glassToggle = document.getElementById('glassToggle');
        const cards = [
            document.getElementById('bg-settings-card'),
            document.getElementById('profile-card'),
            document.getElementById('message-card')
        ];
        
        glassToggle.addEventListener('change', () => {
            if (glassToggle.checked) {
                cards.forEach(card => {
                    card.classList.add('glass-effect');
                });
            } else {
                cards.forEach(card => {
                    card.classList.remove('glass-effect');
                });
            }
            
            // å­˜å‚¨ç”¨æˆ·åå¥½
            localStorage.setItem('glassEffect', glassToggle.checked);
        });
        
        // åˆå§‹åŒ–æ¯›ç»ç’ƒæ•ˆæœ
        if (localStorage.getItem('glassEffect') === 'false') {
            glassToggle.checked = false;
            cards.forEach(card => {
                card.classList.remove('glass-effect');
            });
        } else {
            glassToggle.checked = true;
            cards.forEach(card => {
                card.classList.add('glass-effect');
            });
        }
        
        // åˆå§‹åŒ–èƒŒæ™¯é¢œè‰²
        const savedBgColor = localStorage.getItem('bgColor');
        if (savedBgColor) {
            body.style.backgroundColor = savedBgColor;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            colorBlocks.forEach(block => {
                if (block.getAttribute('data-color') === savedBgColor) {
                    block.classList.add('ring-2', 'ring-primary');
                } else {
                    block.classList.remove('ring-2', 'ring-primary');
                }
            });
        }
        
        // ç¼–è¾‘èµ„æ–™æ¨¡æ€æ¡†
        const editProfileBtn = document.getElementById('editProfileBtn');
        const editProfileModal = document.getElementById('editProfileModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const saveEditBtn = document.getElementById('saveEditBtn');
        const modalAvatar = document.getElementById('modalAvatar');
        const avatarInput = document.getElementById('avatarInput');
        const uploadAvatarBtn = document.getElementById('uploadAvatarBtn');
        const username = document.getElementById('username');
        const bio = document.getElementById('bio');
        const modalUsername = document.getElementById('modalUsername');
        const modalBio = document.getElementById('modalBio');
        
        editProfileBtn.addEventListener('click', () => {
            // åŒæ­¥å½“å‰æ•°æ®åˆ°æ¨¡æ€æ¡†
            modalUsername.value = username.textContent;
            modalBio.value = bio.textContent;
            modalAvatar.src = document.getElementById('avatar').src;
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            editProfileModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
        });
        
        function closeModal() {
            editProfileModal.classList.add('hidden');
            document.body.style.overflow = ''; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
        }
        
        closeModalBtn.addEventListener('click', closeModal);
        cancelEditBtn.addEventListener('click', closeModal);
        
        saveEditBtn.addEventListener('click', () => {
            // æ›´æ–°ä¸ªäººèµ„æ–™
            username.textContent = modalUsername.value;
            bio.textContent = modalBio.value;
            document.getElementById('avatar').src = modalAvatar.src;
            document.getElementById('topAvatar').querySelector('img').src = modalAvatar.src;
            
            // å­˜å‚¨ç”¨æˆ·ä¿¡æ¯
            localStorage.setItem('username', modalUsername.value);
            localStorage.setItem('bio', modalBio.value);
            localStorage.setItem('avatarUrl', modalAvatar.src);
            
            closeModal();
        });
        
        // ä¸Šä¼ å¤´åƒåŠŸèƒ½
        uploadAvatarBtn.addEventListener('click', () => {
            avatarInput.click();
        });
        
        avatarInput.addEventListener('change', (e) => {
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    modalAvatar.src = e.target.result;
                };
                
                reader.readAsDataURL(e.target.files[0]);
            }
        });
        
        // åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯
        if (localStorage.getItem('username')) {
            username.textContent = localStorage.getItem('username');
            modalUsername.value = localStorage.getItem('username');
        }
        
        if (localStorage.getItem('bio')) {
            bio.textContent = localStorage.getItem('bio');
            modalBio.value = localStorage.getItem('bio');
        }
        
        if (localStorage.getItem('avatarUrl')) {
            document.getElementById('avatar').src = localStorage.getItem('avatarUrl');
            document.getElementById('topAvatar').querySelector('img').src = localStorage.getItem('avatarUrl');
            modalAvatar.src = localStorage.getItem('avatarUrl');
        }
        
        // å³ä¸Šè§’å¤´åƒåŒæ­¥
        document.getElementById('topAvatar').querySelector('img').src = document.getElementById('avatar').src;
        
        // å¤´åƒç‚¹å‡»æ”¾å¤§åŠŸèƒ½
        const avatarContainer = document.getElementById('avatarContainer');
        const avatarViewer = document.getElementById('avatarViewer');
        const viewerAvatar = document.getElementById('viewerAvatar');
        const topAvatar = document.getElementById('topAvatar');
        
        function openAvatarViewer(src) {
            viewerAvatar.src = src;
            avatarViewer.classList.remove('hidden');
            
            // ä½¿å¤´åƒå°ºå¯¸æ¯”åŸæ¥å¤§ä¸€å€
            const img = new Image();
            img.onload = function() {
                viewerAvatar.style.width = `${img.width * 2}px`;
                viewerAvatar.style.height = `${img.height * 2}px`;
                
                // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                setTimeout(() => {
                    avatarViewer.classList.add('opacity-100');
                    avatarViewer.querySelector('div').classList.add('scale-100');
                    avatarViewer.querySelector('div').classList.remove('scale-95');
                }, 10);
            };
            img.src = src;
            
            document.body.style.overflow = 'hidden';
        }
        
        function closeAvatarViewer() {
            avatarViewer.classList.remove('opacity-100');
            avatarViewer.querySelector('div').classList.remove('scale-100');
            avatarViewer.querySelector('div').classList.add('scale-95');
            
            setTimeout(() => {
                avatarViewer.classList.add('hidden');
                document.body.style.overflow = '';
            }, 300);
        }
        
        avatarContainer.addEventListener('click', () => {
            openAvatarViewer(document.getElementById('avatar').src);
        });
        
        topAvatar.addEventListener('click', () => {
            openAvatarViewer(topAvatar.querySelector('img').src);
        });
        
        avatarViewer.addEventListener('click', (e) => {
            if (e.target === avatarViewer) {
                closeAvatarViewer();
            }
        });
        
        // å¤´åƒè¾¹é“…ç¬”å›¾æ ‡ç‚¹å‡»äº‹ä»¶
        const changeAvatarBtn = document.getElementById('changeAvatarBtn');
        changeAvatarBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // é˜²æ­¢è§¦å‘å¤´åƒå®¹å™¨çš„ç‚¹å‡»äº‹ä»¶
            avatarInput.click();
        });
        
        // æ›´çœŸå®çš„éšæœºç”¨æˆ·åç”Ÿæˆ
        const realUsernames = [
            // äºŒæ¬¡å…ƒé£æ ¼
            "æ¨±èŠ±é…±ğŸŒ¸", "æ˜Ÿç©ºä¸‹çš„å–µ", "åˆéŸ³æœªæ¥ç²‰", "è½»éŸ³å°‘å¥³", "å¤ç›®å‹äººå¸", "äºŒæ¬¡å…ƒã®é­‚", "åŠ¨æ¼«æ§", "ç¥ã®è„šæœ¬",
            // ç½‘çº¢é£æ ¼
            "ç¾å¦†è¾¾äºº", "ç”Ÿæ´»å°ç¡®å¹¸", "æ—…è¡Œæ—¥è®°", "ç¾é£Ÿæ¢åº—", "å¥èº«æ‰“å¡", "ç©¿æ­åšä¸»", "æ‘„å½±çˆ±å¥½è€…", "å’–å•¡å¸ˆ",
            // æ¸¸æˆç©å®¶
            "å³¡è°·ç‹è€…", "åƒé¸¡å¤§ç¥", "åŸç¥æ—…è¡Œè€…", "èµ›åšæœ‹å…‹", "ç”µç«é€‰æ‰‹", "ç¬¬äº”äººæ ¼", "è‹±é›„è”ç›Ÿ", "ç‹è€…è£è€€",
            // æƒ…æ„Ÿç±»
            "æ²»æ„ˆç³»", "æ·±å¤œæ ‘æ´", "å­¤ç‹¬æ‚£è€…", "æ¸©æŸ”ä»¥å¾…", "äººé—´æ¸…é†’", "æ­£èƒ½é‡", "ä½›ç³»é’å¹´", "æƒ…æ„Ÿå¯¼å¸ˆ",
            // å…¶ä»–
            "é“²å±å®˜", "ç¨‹åºçŒ¿", "è®¾è®¡å¸ˆ", "å­¦ç”Ÿå…š", "è‡ªç”±èŒä¸šè€…", "æ‰“å·¥äºº", "é€€ä¼‘ç”Ÿæ´»", "æ–œæ é’å¹´"
        ];
        
        // å¤šå…ƒå¤´åƒæ¥æº
        function getRandomAvatar() {
            const avatarTypes = [
                // äºŒæ¬¡å…ƒåŠ¨æ¼«å¤´åƒ
                `https://picsum.photos/seed/anime${Math.floor(Math.random() * 100)}/40/40`,
                // insé£æ ¼å¤´åƒ
                `https://picsum.photos/seed/ins${Math.floor(Math.random() * 100)}/40/40`,
                // ç½‘çº¢é«˜è´¨é‡è‡ªæ‹
                `https://picsum.photos/seed/influencer${Math.floor(Math.random() * 100)}/40/40`,
                // è±ªè½¦
                `https://picsum.photos/seed/car${Math.floor(Math.random() * 100)}/40/40`,
                // èŒå® 
                `https://picsum.photos/seed/pet${Math.floor(Math.random() * 100)}/40/40`,
                // è¡¨æƒ…åŒ…
                `https://picsum.photos/seed/meme${Math.floor(Math.random() * 100)}/40/40`,
                // å±±æ°´å›¾ç‰‡
                `https://picsum.photos/seed/nature${Math.floor(Math.random() * 100)}/40/40`,
                // è‡ªæ‹
                `https://picsum.photos/seed/selfie${Math.floor(Math.random() * 100)}/40/40`
            ];
            
            return avatarTypes[Math.floor(Math.random() * avatarTypes.length)];
        }
        
        // æ ¼å¼åŒ–æ—¶é—´ - æ˜¾ç¤ºå®Œæ•´å¹´æœˆæ—¥å’Œæ—¶é—´
        function formatTime(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            
            return `${year}-${month}-${day} ${hours}:${minutes}`;
        }
        
        // å‘é€ç•™è¨€åŠŸèƒ½
        const sendButton = document.getElementById('sendButton');
        const messageInput = document.getElementById('messageInput');
        const messagesContainer = document.getElementById('messagesContainer');
        const sortSelect = document.getElementById('sortSelect');
        const emptyMessage = document.getElementById('emptyMessage');
        const anonymousMessage = document.getElementById('anonymousMessage');
        
        sendButton.addEventListener('click', () => {
            const message = messageInput.value.trim();
            
            if (message) {
                // æ·»åŠ å‘é€åŠ¨ç”»
                sendButton.classList.add('animate-pulse');
                
                // æ¨¡æ‹Ÿå‘é€å»¶è¿Ÿ
                setTimeout(() => {
                    // åˆ›å»ºæ–°ç•™è¨€å…ƒç´ 
                    const now = new Date();
                    const timeString = formatTime(now);
                    
                    let msgUsername, msgAvatar;
                    
                    // æ ¹æ®æ˜¯å¦å‹¾é€‰"åŒ¿åç•™è¨€"å†³å®šä½¿ç”¨ä¸ªäººä¿¡æ¯è¿˜æ˜¯éšæœºä¿¡æ¯
                    if (anonymousMessage.checked) {
                        // ä½¿ç”¨æ›´çœŸå®çš„éšæœºç”¨æˆ·åå’Œå¤šå…ƒå¤´åƒ
                        msgUsername = realUsernames[Math.floor(Math.random() * realUsernames.length)];
                        msgAvatar = getRandomAvatar();
                    } else {
                        msgUsername = username.textContent;
                        msgAvatar = document.getElementById('avatar').src;
                    }
                    
                    const messageElement = document.createElement('div');
                    messageElement.className = 'border-t pt-4';
                    messageElement.innerHTML = `
                        <div class="flex items-start">
                            <img src="${msgAvatar}" alt="${msgUsername}" class="w-10 h-10 rounded-full mr-3 cursor-pointer hover:scale-110 transition-transform duration-300" onclick="openAvatarViewer('${msgAvatar}')">
                            <div class="flex-1">
                                <div class="flex items-center">
                                    <h4 class="font-medium text-dark">${msgUsername}</h4>
                                    <span class="ml-2 text-xs text-gray-400">${timeString}</span>
                                </div>
                                <p class="mt-1 text-gray-600">${message}</p>
                            </div>
                        </div>
                    `;
                    
                    // éšè—ç©ºç•™è¨€æç¤º
                    if (emptyMessage) {
                        emptyMessage.style.display = 'none';
                    }
                    
                    // æ·»åŠ åˆ°å®¹å™¨
                    if (sortSelect.value === 'newest') {
                        messagesContainer.prepend(messageElement);
                    } else {
                        messagesContainer.appendChild(messageElement);
                    }
                    
                    // æ¸…ç©ºè¾“å…¥æ¡†
                    messageInput.value = '';
                    
                    // é‡ç½®æŒ‰é’®çŠ¶æ€
                    sendButton.classList.remove('animate-pulse');
                    
                    // ä¿å­˜ç•™è¨€
                    saveMessage({
                        content: message,
                        time: now.toISOString(),
                        username: msgUsername,
                        avatar: msgAvatar,
                        autoDelete: document.getElementById('autoDelete').checked,
                        isAnonymous: anonymousMessage.checked
                    });
                    
                    // å¦‚æœå‹¾é€‰äº†è‡ªåŠ¨åˆ é™¤ï¼Œè®¾ç½®å®šæ—¶ä»»åŠ¡
                    if (document.getElementById('autoDelete').checked) {
                        const deleteTime = new Date(now.getTime() + 24 * 60 * 60 * 1000);
                        messageElement.setAttribute('data-delete-time', deleteTime.toISOString());
                        
                        // æ£€æŸ¥å¹¶æ¸…ç†è¿‡æœŸç•™è¨€
                        checkExpiredMessages();
                    }
                }, 500);
            }
        });
        
        // æ’åºåŠŸèƒ½
        sortSelect.addEventListener('change', () => {
            const messages = Array.from(messagesContainer.children);
            
            // è·³è¿‡ç©ºç•™è¨€æç¤º
            if (messages[0] && messages[0].id === 'emptyMessage') {
                messages.shift();
            }
            
            // æ¸…ç©ºå®¹å™¨
            messagesContainer.innerHTML = '';
            
            // å¦‚æœæ²¡æœ‰ç•™è¨€ï¼Œæ˜¾ç¤ºç©ºæç¤º
            if (messages.length === 0) {
                if (emptyMessage) {
                    emptyMessage.style.display = 'block';
                }
                return;
            }
            
            // æ ¹æ®é€‰æ‹©é‡æ–°æ·»åŠ 
            if (sortSelect.value === 'newest') {
                messages.reverse().forEach(msg => messagesContainer.appendChild(msg));
            } else {
                messages.forEach(msg => messagesContainer.appendChild(msg));
            }
        });
        
        // æœ¬åœ°å­˜å‚¨ç•™è¨€
        function saveMessage(message) {
            let messages = JSON.parse(localStorage.getItem('messages')) || [];
            messages.unshift(message); // æ·»åŠ åˆ°å¼€å¤´ï¼Œä¿æŒæœ€æ–°çš„åœ¨å‰
            
            // é™åˆ¶æœ€å¤šä¿å­˜100æ¡ç•™è¨€
            if (messages.length > 100) {
                messages = messages.slice(0, 100);
            }
            
            localStorage.setItem('messages', JSON.stringify(messages));
        }
        
        // åˆ é™¤ç•™è¨€
        function deleteMessage(element) {
            element.classList.add('opacity-0');
            setTimeout(() => {
                element.remove();
                
                // æ£€æŸ¥æ˜¯å¦æ²¡æœ‰ç•™è¨€äº†
                const messages = messagesContainer.querySelectorAll('div:not(#emptyMessage)');
                if (messages.length === 0 && emptyMessage) {
                    emptyMessage.style.display = 'block';
                }
            }, 500);
        }
        
        // æ£€æŸ¥è¿‡æœŸç•™è¨€
        function checkExpiredMessages() {
            const now = new Date();
            const messages = messagesContainer.querySelectorAll('[data-delete-time]');
            
            messages.forEach(msg => {
                const deleteTime = new Date(msg.getAttribute('data-delete-time'));
                if (now >= deleteTime) {
                    deleteMessage(msg);
                }
            });
        }
        
        // åŠ è½½æœ¬åœ°å­˜å‚¨çš„ç•™è¨€
        function loadMessages() {
            const messages = JSON.parse(localStorage.getItem('messages')) || [];
            
            // è¿‡æ»¤æ‰è¿‡æœŸçš„ç•™è¨€
            const validMessages = messages.filter(msg => {
                if (msg.autoDelete) {
                    const deleteTime = new Date(new Date(msg.time).getTime() + 24 * 60 * 60 * 1000);
                    return new Date() < deleteTime;
                }
                return true;
            });
            
            // å¦‚æœæ²¡æœ‰æœ‰æ•ˆç•™è¨€ï¼Œæ˜¾ç¤ºç©ºæç¤º
            if (validMessages.length === 0 && emptyMessage) {
                emptyMessage.style.display = 'block';
            }
            
            validMessages.forEach(msg => {
                const messageDate = new Date(msg.time);
                const timeString = formatTime(messageDate);
                
                const messageElement = document.createElement('div');
                messageElement.className = 'border-t pt-4';
                messageElement.innerHTML = `
                    <div class="flex items-start">
                        <img src="${msg.avatar}" alt="${msg.username}" class="w-10 h-10 rounded-full mr-3 cursor-pointer hover:scale-110 transition-transform duration-300" onclick="openAvatarViewer('${msg.avatar}')">
                        <div class="flex-1">
                            <div class="flex items-center">
                                <h4 class="font-medium text-dark">${msg.username}</h4>
                                <span class="ml-2 text-xs text-gray-400">${timeString}</span>
                            </div>
                            <p class="mt-1 text-gray-600">${msg.content}</p>
                        </div>
                    </div>
                `;
                
                // å¦‚æœè®¾ç½®äº†è‡ªåŠ¨åˆ é™¤ï¼Œæ·»åŠ åˆ é™¤æ—¶é—´å±æ€§
                if (msg.autoDelete) {
                    const deleteTime = new Date(messageDate.getTime() + 24 * 60 * 60 * 1000);
                    messageElement.setAttribute('data-delete-time', deleteTime.toISOString());
                }
                
                messagesContainer.appendChild(messageElement);
            });
            
            // ä¿å­˜è¿‡æ»¤åçš„ç•™è¨€
            localStorage.setItem('messages', JSON.stringify(validMessages));
        }
        
        // é¡µé¢åŠ è½½æ—¶åŠ è½½ç•™è¨€
        loadMessages();
        
        // å®šæ—¶æ£€æŸ¥è¿‡æœŸç•™è¨€
        setInterval(checkExpiredMessages, 60 * 60 * 1000); // æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡
        
        // å°†openAvatarViewerå‡½æ•°æ·»åŠ åˆ°å…¨å±€ä½œç”¨åŸŸ
        window.openAvatarViewer = openAvatarViewer;
    </script>
</body>
</html>
    